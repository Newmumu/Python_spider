## 【黑盒测试用例设计】测试方法之因果图法

**原理**：根据输入条件的组合、约束关系和输出条件的因果关系，利用图解法分析输入条件的各种组合情况，写出判定表，从而设计测试用例的方法。

	因果图法最终生成的就是判定表，它适合于检查程序输入条件的各种组合情况。

**基本思想**：等价类划分法和边界值分析方法都是着重考虑输入条件，但没有考虑输入条件的各种组合、输入条件之间的相互制约关系。这样虽然各种输入条件可能出错的情况已经测试到了，但多个输入条件组合起来可能出错的情况却被忽视了。

	如果在测试时必须考虑输入条件的各种组合，则可能的组合数目将是天文数字，因此必须考虑采用一种适合于描述多种条件的组合、相应产生多个动作的形式来进行测试用例的设计，这就需要利用因果图（逻辑模型）。

**适用场景**：多种输入条件组合。

**使用技巧**：因果图法和判定表结合使用。

**使用方法**：

采用因果图法设计测试用例的步骤：

1. 分析软件规格说明描述中, 那些是原因(即输入条件或输入条件的等价类),那些是结果(即输出条件), 并给每个原因和结果赋予一个标识符。
2. 分析软件规格说明描述中的语义，找出原因与结果之间, 原因与原因之间对应的关系，根据这些关系,画出因果图。
3. 由于语法或环境限制, 有些原因与原因之间,原因与结果之间的组合情况不可能出现，为表明这些特殊情况, 在因果图上用一些记号表明约束或限制条件。
4. 把因果图转换为判定表。
5. 把判定表的每一列拿出来作为依据,设计测试用例。

**应用实例**

1. 某软件规格说明书包含这样的要求：
	第一列字符必须是A或B，第二列字符必须是一个数字，在此情况下进行文件的修改，
	但如果第一列字符不正确，则给出信息L；如果第二列字符不是数字，则给出信息M。

解答：
1) 根据题意，原因和结果如下：

	原因：
    1——第一列字符是A；
    2——第一列字符是B；
    3——第二列字符是一数字。
    结果：
    21——修改文件；
    22——给出信息L；
    23——给出信息M。

2) 其对应的因果图如下：

11为中间节点；考虑到原因1和原因2不可能同时为1，因此在因果图上施加E约束。

![因果图](https://www.cnblogs.com/images/cnblogs_com/jackc/tc9.gif)

3) 根据因果图建立判定表。

||				|1|2|3|4|5|6|7|8|
|-|-|-|-|-|-|-|-|-|-|
|条件（字母A） 	  |1|1|1|1 |1 |0 |0 |0 |0 |
|条件（字母B）     |2|1|1|0 |0 |1 |1 |0 |0 |
|条件（数字3）     |3|1|0|1 |0 |1 |0 |1 |0 |
|条件（12组合）    |11|| |1 |1 |1 |1 |0 |0 |
|动作（信息L）     |22|| |0 |0 |0 |0 |1 |1 |
|动作（信息M）     |21|| |0 |1 |0 |1 |0 |0 |
|动作（修改）      |23|| |1 |0 |1 |0 |0 |0 |
|测试用例（）      | | | |A3|AM|B5|BN|C2|DY|
|测试用例（）      | | | |A8|A?|B4|B!|X6|P.|

表中8种情况的左面两列情况中，原因(1)和原因(2)同时为1，这是不可能出现的，故应排除这两种情况。表的最下一栏给出了6种情况的测试用例，这是我们所需要的数据。

2. 有一个处理单价为5角钱的饮料的自动售货机软件测试用例的设计。其规格说明如下：若投入5角钱或1元钱的硬币，押下〖橙汁〗或〖啤酒〗的按钮，则相应的饮料就送出来。若售货机没有零钱找，则一个显示〖零钱找完〗的红灯亮，这时在投入1元硬币并押下按钮后，饮料不送出来而且1元硬币也退出来；若有零钱找，则显示〖零钱找完〗的红灯灭，在送出饮料的同时退还5角硬币。

1) 分析这一段说明，列出原因和结果

原因：

1——售货机有零钱找
2——投入1元硬币
3——投入5角硬币
4——押下橙汁按钮
5——押下啤酒按钮

结果：
21——售货机〖零钱找完〗灯亮   
22——退还1元硬币
23——退还5角硬币             
24——送出橙汁饮料
25——送出啤酒饮料
2) 画出因果图，如图所示。所有原因结点列在左边，所有结果结点列在右边。建立中间结点，表示处理的中间状态。中间结点：

11—— 投入1元硬币且押下饮料按钮
12——押下〖橙汁〗或〖啤酒〗的按钮
13——应当找5角零钱并且售货机有零钱找
14——钱已付清

![因果图](https://www.cnblogs.com/images/cnblogs_com/jackc/tc11.gif)

3) 转换成判定表：

![判定表](https://www.cnblogs.com/images/cnblogs_com/jackc/tc12.gif)

4)    在判定表中，阴影部分表示因违反约束条件的不可能出现的情况，删去。第16列与第32列因什么动作也没做，也删去。最后可根据剩下的16列作为确定测试用例的依据。
